<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>æ¡ç‚¹çµæœ</title>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- çµæœãƒšãƒ¼ã‚¸ç”¨CSS -->
  <link rel="stylesheet" href="{{ url_for('static', filename='css/result.css') }}">
</head>
<body>
  {% if recommended_game %}
    <div id="recommend-wrapper" class="recommend-wrapper">
      <!-- å³ä¸Šã®å°ã•ã„ãƒœã‚¿ãƒ³ï¼ˆå¸¸ã«ã“ã‚Œã ã‘è¦‹ãˆã‚‹ï¼‰ -->
      <button id="recommend-toggle" class="recommend-toggle">
        ğŸ® ãŠã™ã™ã‚ã‚²ãƒ¼ãƒ 
      </button>

      <!-- æŠ˜ã‚ŠãŸãŸã¾ã‚Œã¦ã„ã‚‹ä¸­èº« -->
      <div class="recommend-box">
        <div class="recommend-header">
          <span class="recommend-title">ã‚ãªãŸã«ãŠã™ã™ã‚ã®ã‚²ãƒ¼ãƒ </span>
          <button id="recommend-close" class="recommend-close" aria-label="é–‰ã˜ã‚‹">Ã—</button>
        </div>

        <div class="recommend-name">
          {{ recommended_game.label }}
        </div>
        <div class="recommend-reason">
          {{ recommended_game.reason }}
        </div>

        <a class="recommend-btn" href="/game/{{ recommended_game.id }}">
          ã“ã®ã‚²ãƒ¼ãƒ ã‚’å§‹ã‚ã‚‹ â–¶
        </a>
      </div>
    </div>
  {% endif %}

  <h1>ğŸ æ¡ç‚¹çµæœ</h1>

  <!-- â–¼ å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ« -->
  <div class="card">
    <div class="section-title">ğŸ“„ å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«</div>
    <p class="result-path">{{ result_path }}</p>
  </div>

  <!-- â–¼ ç·åˆã‚¹ã‚³ã‚¢ -->
  <div class="card">
    <div class="section-title">ğŸ† ç·åˆã‚¹ã‚³ã‚¢</div>

    <div class="score-box" style="background: {{ overall_color }}">
      {{ "%.1f"|format(overall_score) }} ç‚¹
    </div>

    <p class="overall-message">
      {{ overall_message }}
    </p>
  </div>

  <!-- â–¼ Eåˆ¥ã‚¹ã‚³ã‚¢ -->
  <div class="card">
    <div class="section-title">ğŸ“Š Eåˆ¥ã‚¹ã‚³ã‚¢ä¸€è¦§</div>

    <table>
      <tr><th>ä½“æ“</th><th>å¹³å‡ã‚¹ã‚³ã‚¢</th></tr>
      {% for row in table_data %}
      <tr>
        <td>{{ EXERCISE_LABEL[row['exercise_id']] }}ï¼ˆ{{ row['exercise_id'] }}ï¼‰</td>
        <td>{{ '%.2f'|format(row['mean_score']) }}</td>
      </tr>
      {% endfor %}
    </table>
  </div>

  <!-- â–¼ å‰å›æ¯”è¼ƒï¼ˆãƒ­ã‚°ã‚¤ãƒ³æ™‚ã®ã¿ï¼‰ -->
  {% if not session.get('guest') %}
  <div class="card">
    <div class="section-title">ğŸ“ˆ å‰å›ãƒ»è‡ªå·±ãƒ™ã‚¹ãƒˆã¨ã®æ¯”è¼ƒ</div>

    {% if compare_rows and compare_rows|length > 0 %}
    <table>
      <tr>
        <th>ä½“æ“</th>
        <th>ä»Šå›</th>
        <th>å‰å›</th>
        <th>å·®åˆ†</th>
        <th>è‡ªå·±ãƒ™ã‚¹ãƒˆ</th>
        <th>ãƒ™ã‚¹ãƒˆã¨ã®å·®</th>
      </tr>

      {% for row in compare_rows %}
      <tr>
        <td>{{ row.label }} ({{ row.exercise }})</td>
        <td>{{ '%.2f'|format(row.curr) }}</td>
        <td>{% if row.prev is not none %}{{ '%.2f'|format(row.prev) }}{% else %}-{% endif %}</td>
        <td>{% if row.diff_prev is not none %}{{ '%.2f'|format(row.diff_prev) }}{% else %}-{% endif %}</td>
        <td>{% if row.best is not none %}{{ '%.2f'|format(row.best) }}{% else %}-{% endif %}</td>
        <td>{% if row.diff_best is not none %}{{ '%.2f'|format(row.diff_best) }}{% else %}-{% endif %}</td>
      </tr>
      {% endfor %}
    </table>

    {% else %}
      <p>å‰å›ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“ã€‚</p>
    {% endif %}
  </div>
  {% endif %}

  <!-- â–¼ å‹•ããŒå°ã•ã‹ã£ãŸéƒ¨ä½ -->
  <div class="card">
    <div class="section-title">ğŸ§© å…¨ä½“ã§å‹•ããŒå°ã•ã‹ã£ãŸéƒ¨ä½</div>

    <ul class="feedback-list">
      {% for msg in global_feedback %}
        <li>ãƒ»{{ msg }}</li>
      {% endfor %}
    </ul>
  </div>

  <!-- â–¼ ä¸‹ä½3ã¤ -->
  <div class="card">
    <div class="section-title">â¬‡ï¸ ã‚¹ã‚³ã‚¢ãŒä½ã‹ã£ãŸä½“æ“ï¼ˆä¸‹ä½3ã¤ï¼‰</div>

    <p>
      {% if low_labels %}
        {{ low_labels|join("ã€ ") }}
      {% else %}
        ç‰¹ã«ä½ã„ä½“æ“ã¯ã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚
      {% endif %}
    </p>
  </div>

  <!-- â–¼ éƒ¨ä½åˆ¥ã‚¢ãƒ‰ãƒã‚¤ã‚¹ -->
  <div class="card">
    <div class="section-title">ğŸ§  éƒ¨ä½åˆ¥ã‚¢ãƒ‰ãƒã‚¤ã‚¹</div>

    {% for ex, msg in exercise_advice.items() %}
      <div class="advice-ex-name">
        {{ EXERCISE_LABEL[ex] }}ï¼ˆ{{ ex }}ï¼‰
      </div>
      <p class="advice-message">
        ğŸ’¡ {{ msg }}
      </p>
    {% endfor %}
  </div>

  <!-- â–¼ ã‚°ãƒ©ãƒ• -->
  <div class="card">
    <div class="section-title">ğŸ“‰ ã‚°ãƒ©ãƒ•</div>

    <canvas id="chart" width="600" height="350"></canvas>
  </div>

  <!-- â–¼ ãƒœã‚¿ãƒ³ -->
  <button onclick="window.location.href='/record'">ã‚‚ã†ä¸€åº¦ä½“æ“ã™ã‚‹</button>
  <a href="/logout">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</a>

  <!-- Chartç”¨ãƒ‡ãƒ¼ã‚¿ã‚’JSã«æ¸¡ã™ï¼ˆæœ€å°é™ã®inlineï¼‰ -->
  <script>
    window.resultChartData = {
      labels: {{ exercises|tojson|safe }},
      scores: {{ scores|tojson|safe }}
    };
  </script>

  <!-- çµæœãƒšãƒ¼ã‚¸ç”¨JS -->
  <script src="{{ url_for('static', filename='js/result.js') }}"></script>
</body>
</html>
