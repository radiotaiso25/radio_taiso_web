<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>è‚©ã‚¹ãƒ¯ã‚¤ãƒ—ã‚­ãƒ£ãƒƒãƒã‚²ãƒ¼ãƒ </title>

  <style>
    body {
      font-family: "YuGothic", "Hiragino Kaku Gothic ProN", sans-serif;
      background: #f5f9ff;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    header {
      width: 100%;
      padding: 16px 24px;
      box-sizing: border-box;
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: #ffffff;
      border-bottom: 1px solid #dde6f5;
    }

    header h1 {
      margin: 0;
      font-size: 20px;
      color: #1a4c8a;
    }

    header button {
      padding: 6px 14px;
      font-size: 13px;
      border-radius: 999px;
      border: none;
      background: #eee;
      cursor: pointer;
    }

    .container {
      margin-top: 20px;
      max-width: 900px;
      width: 100%;
      padding: 0 16px 40px;
      box-sizing: border-box;
      text-align: center;
    }

    .description {
      background: #ffffff;
      border-radius: 12px;
      padding: 16px 20px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.06);
      font-size: 14px;
      line-height: 1.7;
      text-align: left;
      margin-bottom: 16px;
    }

    .description ul {
      padding-left: 20px;
      margin: 4px 0 0 0;
    }

    .info-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin: 12px 0 8px;
      font-size: 14px;
    }

    .info-item {
      background: #ffffff;
      border-radius: 999px;
      padding: 6px 14px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.05);
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .info-label {
      color: #555;
    }

    .info-value {
      font-weight: bold;
      color: #1a4c8a;
      min-width: 36px;
      text-align: right;
    }

    .game-area {
      position: relative;
      margin: 0 auto;
      margin-top: 10px;
      width: 700px;
      height: 260px;
      background: #e6f0ff;
      border-radius: 18px;
      box-shadow: 0 6px 16px rgba(0,0,0,0.12);
      overflow: hidden;
    }

    .lane {
      position: absolute;
      top: 0;
      bottom: 0;
      width: 50%;
    }
    .lane.left { left: 0; background: linear-gradient(to right, #e8f3ff, #e6f0ff); }
    .lane.right { right: 0; background: linear-gradient(to left, #e8f3ff, #e6f0ff); }

    .player {
      position: absolute;
      bottom: 12px;
      width: 120px;
      height: 16px;
      border-radius: 999px;
      background: #ffb74d;
      left: calc(50% - 60px);
      transition: left 0.15s ease-out;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 11px;
      color: #5d3b00;
    }

    .ball {
      position: absolute;
      width: 34px;
      height: 34px;
      border-radius: 50%;
      background: #ff5252;
      box-shadow: 0 4px 10px rgba(0,0,0,0.2);
    }

    .hint {
      font-size: 13px;
      color: #666;
      margin-top: 8px;
    }

    .button-row {
      margin-top: 16px;
      display: flex;
      justify-content: center;
      gap: 12px;
    }

    .btn-main {
      padding: 10px 22px;
      font-size: 15px;
      border-radius: 999px;
      border: none;
      background: #4caf50;
      color: #fff;
      cursor: pointer;
    }

    .btn-sub {
      padding: 8px 18px;
      font-size: 14px;
      border-radius: 999px;
      border: none;
      background: #9e9e9e;
      color: #fff;
      cursor: pointer;
    }

    .result-message {
      margin-top: 12px;
      font-size: 14px;
      font-weight: bold;
      color: #d84315;
    }
  </style>
</head>
<body>
  <header>
    <h1>ğŸ® è‚©ã‚¹ãƒ¯ã‚¤ãƒ—ã‚­ãƒ£ãƒƒãƒ</h1>
    <button onclick="location.href='/'">ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ã¸æˆ»ã‚‹</button>
  </header>

  <div class="container">
    <div class="description">
      <b>ã€ã‚²ãƒ¼ãƒ ã®ç›®çš„ã€‘</b><br>
      å·¦å³ã«è…•ã‚’å¤§ããå‹•ã‹ã™ã‚¤ãƒ¡ãƒ¼ã‚¸ã§ã€ãƒœãƒ¼ãƒ«ã‚’ã‚­ãƒ£ãƒƒãƒã™ã‚‹ã‚²ãƒ¼ãƒ ã§ã™ã€‚<br>
      æœ€åˆã¯ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰æ“ä½œã§è©¦ã—ã€ã‚ã¨ã‹ã‚‰è…•ã®å‹•ãï¼ˆMediaPipeï¼‰ã«å¯¾å¿œã•ã›ã‚„ã™ã„ä½œã‚Šã«ãªã£ã¦ã„ã¾ã™ã€‚<br>
      <ul>
        <li>å·¦å³ã‚­ãƒ¼ï¼ˆâ† â†’ï¼‰ã§ãƒãƒ¼ã‚’å‹•ã‹ã—ã¦ã€èµ¤ã„ãƒœãƒ¼ãƒ«ã‚’ã‚­ãƒ£ãƒƒãƒ</li>
        <li>åˆ¶é™æ™‚é–“ï¼š<b>30ç§’</b></li>
        <li>ã‚­ãƒ£ãƒƒãƒã§ããŸæ•°ãŒã‚¹ã‚³ã‚¢ã«ãªã‚Šã¾ã™</li>
      </ul>
    </div>

    <div class="info-bar">
      <div class="info-item">
        <span class="info-label">ã‚¹ã‚³ã‚¢</span>
        <span id="score" class="info-value">0</span>
      </div>
      <div class="info-item">
        <span class="info-label">æ®‹ã‚Šæ™‚é–“</span>
        <span id="time" class="info-value">30</span>
        <span>ç§’</span>
      </div>
    </div>

    <div class="game-area" id="gameArea">
      <div class="lane left"></div>
      <div class="lane right"></div>
      <div class="player" id="player">â† å·¦ / å³ â†’</div>
    </div>

    <div class="hint">
      ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã® <b>â† â†’</b> ã‚­ãƒ¼ã§ãƒãƒ¼ã‚’å·¦å³ã«å‹•ã‹ã—ã¾ã™ã€‚<br>
      å°†æ¥çš„ã«ã¯ã€Œè‚©ã®å·¦å³æŒ™ä¸Šã€ã®è§’åº¦ã§ã“ã®ãƒãƒ¼ã‚’å‹•ã‹ã™ã‚ˆã†ã«ç½®ãæ›ãˆã§ãã¾ã™ã€‚
    </div>

    <div class="button-row">
      <button class="btn-main" id="startBtn">â–¶ ã‚²ãƒ¼ãƒ é–‹å§‹</button>
      <button class="btn-sub" onclick="location.href='/record'">ãƒ©ã‚¸ã‚ªä½“æ“ã«æˆ»ã‚‹</button>
    </div>

    <div id="resultMessage" class="result-message"></div>
  </div>

  <script>
    const gameArea = document.getElementById("gameArea");
    const player = document.getElementById("player");
    const scoreSpan = document.getElementById("score");
    const timeSpan = document.getElementById("time");
    const startBtn = document.getElementById("startBtn");
    const resultMessage = document.getElementById("resultMessage");

    const gameWidth = 700;
    const playerWidth = 120;
    let playerX = (gameWidth - playerWidth) / 2;

    let score = 0;
    let timeLeft = 30;
    let timerId = null;
    let ballTimerId = null;
    let balls = [];
    let isPlaying = false;

    function updatePlayerPosition() {
      player.style.left = playerX + "px";
    }

    function movePlayer(direction) {
      if (!isPlaying) return;
      const step = 60;
      if (direction === "left") {
        playerX = Math.max(20, playerX - step);
      } else if (direction === "right") {
        playerX = Math.min(gameWidth - playerWidth - 20, playerX + step);
      }
      updatePlayerPosition();
    }

    document.addEventListener("keydown", (e) => {
      if (e.key === "ArrowLeft") movePlayer("left");
      if (e.key === "ArrowRight") movePlayer("right");
    });

    function createBall() {
      if (!isPlaying) return;

      const ball = document.createElement("div");
      ball.className = "ball";
      const lane = Math.random() < 0.5 ? "left" : "right";
      const laneOffset = lane === "left" ? gameWidth * 0.15 : gameWidth * 0.55;
      const randomOffset = Math.random() * (gameWidth * 0.25);
      const x = laneOffset + randomOffset;

      ball.style.left = x + "px";
      ball.style.top = "-40px";

      gameArea.appendChild(ball);

      const speed = 2 + Math.random() * 1.5;
      balls.push({ el: ball, x: x, y: -40, speed: speed });

      if (ballTimerId) {
        clearTimeout(ballTimerId);
      }
      const nextInterval = 600 + Math.random() * 600;
      ballTimerId = setTimeout(createBall, nextInterval);
    }

    function updateBalls() {
      if (!isPlaying) return;

      const playerRect = player.getBoundingClientRect();
      const areaRect = gameArea.getBoundingClientRect();

      balls.forEach((b) => {
        b.y += b.speed;
        b.el.style.top = b.y + "px";

        const ballRect = b.el.getBoundingClientRect();

        const overlap =
          ballRect.bottom >= playerRect.top &&
          ballRect.top <= playerRect.bottom &&
          ballRect.right >= playerRect.left &&
          ballRect.left <= playerRect.right;

        if (overlap && !b.caught) {
          b.caught = true;
          score += 1;
          scoreSpan.textContent = score;
          b.el.style.background = "#ffca28";
          setTimeout(() => {
            if (b.el && b.el.parentNode) {
              b.el.parentNode.removeChild(b.el);
            }
          }, 80);
        }

        if (b.y > areaRect.height + 40) {
          if (b.el && b.el.parentNode) {
            b.el.parentNode.removeChild(b.el);
          }
        }
      });

      balls = balls.filter(b => b.y <= gameArea.clientHeight + 40 && !b.caught || b.caught);

      requestAnimationFrame(updateBalls);
    }

    function startGame() {
      if (isPlaying) return;

      isPlaying = true;
      score = 0;
      timeLeft = 30;
      scoreSpan.textContent = "0";
      timeSpan.textContent = timeLeft.toString();
      resultMessage.textContent = "";
      playerX = (gameWidth - playerWidth) / 2;
      updatePlayerPosition();

      balls.forEach(b => {
        if (b.el && b.el.parentNode) {
          b.el.parentNode.removeChild(b.el);
        }
      });
      balls = [];

      startBtn.textContent = "ãƒ—ãƒ¬ã‚¤ä¸­â€¦";
      startBtn.disabled = true;

      createBall();
      requestAnimationFrame(updateBalls);

      timerId = setInterval(() => {
        timeLeft -= 1;
        timeSpan.textContent = timeLeft.toString();

        if (timeLeft <= 0) {
          endGame();
        }
      }, 1000);
    }

    function endGame() {
      if (!isPlaying) return;
      isPlaying = false;

      clearInterval(timerId);
      clearTimeout(ballTimerId);

      startBtn.textContent = "ã‚‚ã†ä¸€åº¦éŠã¶";
      startBtn.disabled = false;

      if (score >= 15) {
        resultMessage.textContent = "ã™ã”ã„ï¼è‚©ã¾ã‚ã‚Šã‚’ã—ã£ã‹ã‚Šå‹•ã‹ã›ã¦ã„ã¾ã™ ğŸ‘";
      } else if (score >= 8) {
        resultMessage.textContent = "ã„ã„æ„Ÿã˜ã§ã™ï¼å°‘ã—ãšã¤è…•ã‚’å¤§ããå‹•ã‹ã—ã¦ã„ãã¾ã—ã‚‡ã†ã€‚";
      } else {
        resultMessage.textContent = "ç„¡ç†ã®ãªã„ç¯„å›²ã§ã€ã‚‚ã†å°‘ã—ã ã‘è…•ã‚’å¤§ããå‹•ã‹ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚";
      }
    }

    startBtn.addEventListener("click", startGame);

    updatePlayerPosition();
  </script>
</body>
</html>
