<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>ä½“å¹¹ãƒ•ãƒ©ãƒ•ãƒ¼ãƒ—ã‚²ãƒ¼ãƒ </title>
  <style>
    body {
      font-family: "YuGothic", "Hiragino Kaku Gothic ProN", sans-serif;
      background: #f5f9ff;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    header {
      width: 100%;
      padding: 16px 24px;
      box-sizing: border-box;
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: #ffffff;
      border-bottom: 1px solid #dde6f5;
    }
    header h1 {
      margin: 0;
      font-size: 20px;
      color: #1a4c8a;
    }
    header button {
      padding: 6px 14px;
      font-size: 13px;
      border-radius: 999px;
      border: none;
      background: #eee;
      cursor: pointer;
    }
    .container {
      margin-top: 20px;
      max-width: 900px;
      width: 100%;
      padding: 0 16px 40px;
      box-sizing: border-box;
      text-align: center;
    }
    .description {
      background: #ffffff;
      border-radius: 12px;
      padding: 16px 20px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.06);
      font-size: 14px;
      line-height: 1.7;
      text-align: left;
      margin-bottom: 16px;
    }
    .description ul {
      padding-left: 20px;
      margin: 4px 0 0 0;
    }
    .info-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin: 12px 0 8px;
      font-size: 14px;
    }
    .info-item {
      background: #ffffff;
      border-radius: 999px;
      padding: 6px 14px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.05);
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }
    .info-label {
      color: #555;
    }
    .info-value {
      font-weight: bold;
      color: #1a4c8a;
      min-width: 36px;
      text-align: right;
    }

    .game-area {
      position: relative;
      margin: 0 auto;
      margin-top: 10px;
      width: 600px;
      height: 260px;
      background: #e6f7f2;
      border-radius: 18px;
      box-shadow: 0 6px 16px rgba(0,0,0,0.12);
      overflow: hidden;
    }

    .ground {
      position: absolute;
      bottom: 50px;
      left: 0;
      right: 0;
      height: 4px;
      background: #b2dfdb;
    }

    .target-zone {
      position: absolute;
      bottom: 50px;
      left: 50%;
      width: 160px;
      height: 60px;
      transform: translateX(-50%);
      border-radius: 80px;
      border: 2px dashed #26a69a;
      box-sizing: border-box;
    }

    .hoop {
      position: absolute;
      bottom: 80px;
      left: 50%;
      width: 220px;
      height: 220px;
      margin-left: -110px;
      border-radius: 50%;
      border: 8px solid rgba(255, 193, 7, 0.9);
      box-shadow: 0 4px 10px rgba(0,0,0,0.18);
      transform-origin: 50% 80%;
    }

    .body {
      position: absolute;
      bottom: 115px;
      left: 50%;
      width: 40px;
      height: 90px;
      margin-left: -20px;
      background: #90caf9;
      border-radius: 20px;
      transform-origin: 50% 100%;
    }

    .head {
      position: absolute;
      bottom: 195px;
      left: 50%;
      width: 40px;
      height: 40px;
      margin-left: -20px;
      border-radius: 50%;
      background: #ffe082;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
    }

    .hint {
      font-size: 13px;
      color: #666;
      margin-top: 8px;
    }
    .button-row {
      margin-top: 16px;
      display: flex;
      justify-content: center;
      gap: 12px;
    }
    .btn-main {
      padding: 10px 22px;
      font-size: 15px;
      border-radius: 999px;
      border: none;
      background: #4caf50;
      color: #fff;
      cursor: pointer;
    }
    .btn-sub {
      padding: 8px 18px;
      font-size: 14px;
      border-radius: 999px;
      border: none;
      background: #9e9e9e;
      color: #fff;
      cursor: pointer;
    }
    .result-message {
      margin-top: 12px;
      font-size: 14px;
      font-weight: bold;
      color: #d84315;
    }
  </style>
</head>
<body>
  <header>
    <h1>ğŸ® ä½“å¹¹ãƒ•ãƒ©ãƒ•ãƒ¼ãƒ—</h1>
    <button onclick="location.href='/'">ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ã¸æˆ»ã‚‹</button>
  </header>

  <div class="container">
    <div class="description">
      <b>ã€ã‚²ãƒ¼ãƒ ã®ç›®çš„ã€‘</b><br>
      ä½“ã‚’å·¦å³ã«ã‚†ã£ãã‚Šå€’ã™ã‚¤ãƒ¡ãƒ¼ã‚¸ã§ã€ãƒ•ãƒ©ãƒ•ãƒ¼ãƒ—ã‚’å®‰å®šã•ã›ã‚‹ã‚²ãƒ¼ãƒ ã§ã™ã€‚<br>
      å°†æ¥ã¯ã€Œä¸ŠåŠèº«ã®å‚¾ãï¼ˆä½“å¹¹ã®è§’åº¦ï¼‰ã€ã§æ“ä½œã™ã‚‹æƒ³å®šã§ã™ãŒã€ã¾ãšã¯ã‚­ãƒ¼æ“ä½œã§è©¦ã›ã‚‹ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚<br>
      <ul>
        <li>å·¦å³ã‚­ãƒ¼ï¼ˆâ† â†’ï¼‰ã§ä½“ã‚’å·¦å³ã«ã‚†ã‚‰ã—ã¦ãƒãƒ©ãƒ³ã‚¹ã‚’å–ã‚‹</li>
        <li>ãƒ•ãƒ©ãƒ•ãƒ¼ãƒ—ã®ä¸­å¿ƒãŒã€çœŸã‚“ä¸­ã®ã‚¾ãƒ¼ãƒ³ã«è¿‘ã„ã»ã©é«˜ã‚¹ã‚³ã‚¢</li>
        <li>åˆ¶é™æ™‚é–“ï¼š<b>30ç§’</b></li>
      </ul>
    </div>

    <div class="info-bar">
      <div class="info-item">
        <span class="info-label">å®‰å®šåº¦</span>
        <span id="score" class="info-value">0</span>
        <span>/ 100</span>
      </div>
      <div class="info-item">
        <span class="info-label">æ®‹ã‚Šæ™‚é–“</span>
        <span id="time" class="info-value">30</span>
        <span>ç§’</span>
      </div>
    </div>

    <div class="game-area" id="gameArea">
      <div class="ground"></div>
      <div class="target-zone"></div>
      <div class="hoop" id="hoop"></div>
      <div class="body" id="body"></div>
      <div class="head"></div>
    </div>

    <div class="hint">
      ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã® <b>â† â†’</b> ã‚­ãƒ¼ã§ã€ä½“ã‚’å·¦å³ã«å°‘ã—ã ã‘å‚¾ã‘ã‚‹ã‚¤ãƒ¡ãƒ¼ã‚¸ã§ã™ã€‚<br>
      å°†æ¥çš„ã«ã¯ã€Œä¸ŠåŠèº«ã®å‚¾ãè§’åº¦ã€ã‹ã‚‰ã“ã®ã‚†ã‚Œå…·åˆã‚’æ±ºã‚ã‚‹å½¢ã«å·®ã—æ›¿ãˆã§ãã¾ã™ã€‚
    </div>

    <div class="button-row">
      <button class="btn-main" id="startBtn">â–¶ ã‚²ãƒ¼ãƒ é–‹å§‹</button>
      <button class="btn-sub" onclick="location.href='/record'">ãƒ©ã‚¸ã‚ªä½“æ“ã«æˆ»ã‚‹</button>
    </div>

    <div id="resultMessage" class="result-message"></div>
  </div>

  <script>
    const hoop = document.getElementById("hoop");
    const body = document.getElementById("body");
    const scoreSpan = document.getElementById("score");
    const timeSpan = document.getElementById("time");
    const startBtn = document.getElementById("startBtn");
    const resultMessage = document.getElementById("resultMessage");

    let angle = 0;           // ä½“å¹¹ã®å‚¾ãï¼ˆ-30 ï½ +30åº¦ï¼‰
    let velocity = 0;        // ã‚†ã‚Œã®é€Ÿåº¦
    let isPlaying = false;
    let timeLeft = 30;
    let timerId = null;
    let stabilityAccum = 0;  // å®‰å®šåº¦ã®ç©ç®—
    let frameCount = 0;

    function updateVisual() {
      hoop.style.transform = `rotate(${angle}deg)`;
      body.style.transform = `rotate(${angle}deg)`;
    }

    document.addEventListener("keydown", (e) => {
      if (!isPlaying) return;
      const step = 2.5; // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒè‡ªåˆ†ã§å‹•ã‹ã™åˆ†
      if (e.key === "ArrowLeft") {
        angle -= step;
      } else if (e.key === "ArrowRight") {
        angle += step;
      }
      angle = Math.max(-30, Math.min(30, angle));
      updateVisual();
    });

    function loop() {
      if (!isPlaying) return;

      // å¾®å¦™ãªãƒ©ãƒ³ãƒ€ãƒ ã‚†ã‚Œï¼ˆå¤–ä¹±ï¼‰ã‚’è¶³ã™ â†’ ãƒãƒ©ãƒ³ã‚¹ã‚’å–ã‚Šç¶šã‘ã‚‹æ„Ÿã˜
      const randomForce = (Math.random() - 0.5) * 0.4;
      velocity += randomForce;
      velocity *= 0.98;          // æ¸›è¡°
      angle += velocity;
      angle = Math.max(-35, Math.min(35, angle));

      updateVisual();

      // å®‰å®šåº¦ã®è©•ä¾¡: è§’åº¦ãŒ0ã«è¿‘ã„ã»ã©è‰¯ã„
      const absAngle = Math.abs(angle);
      // 0åº¦ãªã‚‰1.0ã€30åº¦ã§0, ãã‚Œä»¥ä¸Šã¯ãƒã‚¤ãƒŠã‚¹ã«ã—ãªã„
      const frameScore = Math.max(0, (30 - absAngle) / 30);
      stabilityAccum += frameScore;
      frameCount += 1;

      requestAnimationFrame(loop);
    }

    function startGame() {
      if (isPlaying) return;
      isPlaying = true;
      angle = 0;
      velocity = 0;
      timeLeft = 30;
      stabilityAccum = 0;
      frameCount = 0;
      scoreSpan.textContent = "0";
      timeSpan.textContent = timeLeft.toString();
      resultMessage.textContent = "";
      updateVisual();

      startBtn.textContent = "ãƒ—ãƒ¬ã‚¤ä¸­â€¦";
      startBtn.disabled = true;

      requestAnimationFrame(loop);

      timerId = setInterval(() => {
        timeLeft -= 1;
        timeSpan.textContent = timeLeft.toString();

        if (timeLeft <= 0) {
          endGame();
        }
      }, 1000);
    }

    function endGame() {
      if (!isPlaying) return;
      isPlaying = false;
      clearInterval(timerId);

      // å¹³å‡å®‰å®šåº¦ã‚’ 0~100 ã«ä¸¸ã‚ã‚‹
      const avg = frameCount > 0 ? stabilityAccum / frameCount : 0;
      const score = Math.round(avg * 100);
      scoreSpan.textContent = score.toString();

      startBtn.textContent = "ã‚‚ã†ä¸€åº¦éŠã¶";
      startBtn.disabled = false;

      if (score >= 80) {
        resultMessage.textContent = "ä½“å¹¹ãƒãƒ©ãƒ³ã‚¹ã°ã£ã¡ã‚Šï¼ã¨ã¦ã‚‚å®‰å®šã—ã¦ã„ã¾ã—ãŸ ğŸ‘";
      } else if (score >= 50) {
        resultMessage.textContent = "è‰¯ã„æ„Ÿã˜ã§ã™ã€‚ç„¡ç†ã®ãªã„ç¯„å›²ã§ã€å°‘ã—ãšã¤å®‰å®šã•ã›ã¦ã„ãã¾ã—ã‚‡ã†ã€‚";
      } else {
        resultMessage.textContent = "ä»Šæ—¥ã¯å°‘ã—æºã‚ŒãŒå¤§ãã‚ã§ã—ãŸã€‚ã‚†ã£ãã‚Šå‘¼å¸ã—ãªãŒã‚‰ã€å°ã•ãªå‹•ãã§ãƒãƒ©ãƒ³ã‚¹ã‚’å–ã£ã¦ã¿ã¾ã—ã‚‡ã†ã€‚";
      }
    }

    startBtn.addEventListener("click", startGame);
    updateVisual();
  </script>
</body>
</html>
